<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>trevershick.github.io</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/trevershick">View On GitHub</a></li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1><a href="/">trevershick.github.io</a></h1>
         <!-- <p>Trever Shick Github Page</p> -->
          <hr>
        </div>
        
        <h2>Create a Defect in Rally from a Screenshot Automator Service</h2>
<p class="meta">09 Sep 2012</p>

<div id="post">
<p>We use Rally at work for managing our development efforts. The tool itself is OK but something as simple as creating a defect can take too long. Some defects were going unreported because it was too cumbersome to enter even very minor cosmetic bugs. A couple of years ago I used a Rally tool for creating defects from screenshots and this was great but apparently itâs no longer maintained. In lieu of creating an entire application I decided to glue together the actions via Appleâs Automator application, some AppleScript and Ruby.</p>
<p>The first thing I did was to use the excellent Rally APIs via the rally_rest_api gem for Ruby. This allows you pretty much full access to all of your information in Rally, even uploading screenshots. I created a simple script called createdefect.rb that uses the API, creates a defect in a project and attaches the screenshot. The script itself takes only three arguments at this point&#160;: the defect title, the file name to attach and the Rally project. Hereâs an example:</p>
<p><code> ./createdefect.rb âThis is my defectâ â~/Desktop/bug01.pngâ âRizzoâ </code></p>
<p>This creates a defect in the project âRizzo (new SSO)â with the given title and attachment. The project doesnât have to match exactly, a downcase.start_with? predicate is used to locate the project.</p>
<p>With Ruby script working, I wanted a way to invoke it using a shortcut key or through the services menu on my Mac. I had used Automator before so I figured I could get it done that way. I created a Service Workflow in automator that invoked the ruby script. Before invocation however, I needed to get some input from the user (me) to pass to the script.</p>
<p>First - the title. I wrote an apple script to get feedback from the user using the âdisplay dialogâ commands in AppleScript. Unfortunately, it wasnât until after completion that I noticed that a simple âAsk for Textâ action exists in Automator. Oh well.</p>
<p>Second - the project. I found a nice forum post (sorry i lost the link) that shows how to use the âchoose from listâ applescript function. This allowed me to supply a list of projects from which to choose.</p>
<p>Third - the image. This is built in to Automator. When you create an automator service, you define the type of input that is accepted. I chose âimage filesâ.</p>
<p>So, the entire automator workflow essentially goes like this:</p>
<ol><li>accept image file(s)</li>
<li>Set âImageFileâ variable to the input.</li>
<li>Run AppleScript to get the Defect Title via a dialog box</li>
<li>Set âTitleâ variable to AppleScript output</li>
<li>Run AppleScript to allow the user to choose the project</li>
<li>Set âRallyProjectâ to the user choice</li>
<li>Get Variable (âTitleâ)</li>
<li>Get Variable (âRallyProjectâ)</li>
<li>Get Variable (âImageFileâ)</li>
<li>Run Shell Script /Users/trevershick/bin/createdefect.rb &#8220;$1&#8221; &#8220;$3&#8221; &#8220;$2&#8221; | grep &#8220;defect created&#8221;</li>
<li>Run AppleScript to display the created defect number</li>
</ol><h1>Automator</h1>
<p><img height="750" src="http://media.tumblr.com/tumblr_ma2dre2iY71qbb5om.png" width="327"/></p>
<h1>Workflow Results (in screenshots)</h1>
<h2>Invoke the Service</h2>
<p><img alt="image" src="http://media.tumblr.com/tumblr_ma2dgl1bnG1qbb5om.png"/></p>
<h2>Provide a Defect Title</h2>
<p><img alt="image" src="http://media.tumblr.com/tumblr_ma2dgvwVHd1qbb5om.png"/></p>
<h2>Choose a Project</h2>
<p><img alt="image" src="http://media.tumblr.com/tumblr_ma2dg50kBL1qbb5om.png"/></p>
<h2>Defect Confirmation</h2>
<p><img alt="image" src="http://media.tumblr.com/tumblr_ma2dqov2Ub1qbb5om.png"/></p>
<h2>Result in Rally</h2>
<p><img alt="image" src="http://media.tumblr.com/tumblr_ma2dfwrrrX1qbb5om.png"/></p>
<h1>Issues</h1>
<p>I had several issues working with Ruby and the Automator. Mainly I had issues because I use rvm and when Automator executes shell scripts, it doesnât have the benefit of rvm. I worked around this issue by using the stock Ruby install on the mac to test/run the createdefect.rb script which also required gems be installed globally on the mac. Perhaps I could have worked around this by invoking rvm or by installing rvm as the root user but I simply didnât care enough to do that. The stock ruby install works fine.</p>
<h1>Code</h1>
<script src="https://gist.github.com/3682539.js?file=createdefect.rb" type="text/javascript"></script><script src="https://gist.github.com/3682539.js?file=GetDefectTitle.scpt" type="text/javascript"></script><script src="https://gist.github.com/3682539.js?file=GetProject.scpt" type="text/javascript"></script>

</div>

     
      </section>
<!--
      <span class="credits left">Project maintained by <a href="https://github.com/trevershick">trevershick</a></span>
      <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
-->
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
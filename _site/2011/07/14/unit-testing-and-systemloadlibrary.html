<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>trevershick.github.io</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/trevershick">View On GitHub</a></li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1><a href="/">trevershick.github.io</a></h1>
         <!-- <p>Trever Shick Github Page</p> -->
          <hr>
        </div>
        
        <h2>Unit Testing and System.loadLibrary</h2>
<p class="meta">14 Jul 2011</p>

<div id="post">
<p>I came across a real unit testing nightmare the other day attempting to write tests for the new SSO system.  SiteMinder has it&#8217;s own SDK and agent API that you can extend, but it&#8217;s all based on JNI.  Even though my code was implemented in pure java, I had to implement an interface (<a href="https://support.ca.com/cadocs/0/CA%20SiteMinder%20r12%20SP2-ENU/Bookshelf_Files/HTML/javadoc-sm/com/netegrity/policyserver/smapi/ActiveExpression.html">com.netegrity.policyserver.smapi.ActiveExpression</a>) and use a class (<a href="https://support.ca.com/cadocs/0/CA%20SiteMinder%20r12%20SP2-ENU/Bookshelf_Files/HTML/javadoc-sm/com/netegrity/policyserver/smapi/ActiveExpressionContext.html">com.netegrity.policyserver.smapi.ActiveExpressionContext</a>) that had a static initializer loading a native library.  </p>

<p>In prior fights with this situation, I have refactored all behavior out into another class that mirrors the API of the offending class and then simply delegated to my nice new shiny testable class.  But I don&#8217;t like that because it creates more lines of code which are solely for unit testing, and makes the reader of the code say &#8220;What&#8217;s this for?&#8221;.  In other words, it smells.</p>

<p>After doing some searching, I came across <a href="http://code.google.com/p/powermock/">PowerMock</a> .  <a href="http://code.google.com/p/powermock/">PowerMock</a> allows me to unit test my class as is by suppressing the static initializer. Here&#8217;s a snippet of my code:</p>

<p><script src="https://gist.github.com/1082303.js?file=GetAccessCookieActiveExpressionTest.java"></script></p>

<p>PowerMock isn&#8217;t perfect.  You are forced to run the test with the PowerMock runner instead of the stock Junit runner or even the Spring JUnit runner, but it&#8217;s benefits definitely outweigh the drawbacks.</p>

<p>I urge you to take a look at <a href="http://code.google.com/p/powermock/">PowerMock</a>. It&#8217;s nice.</p>

<p><script src="https://gist.github.com/1082303.js?file=pom.xml"></script></p>

</div>

     
      </section>
<!--
      <span class="credits left">Project maintained by <a href="https://github.com/trevershick">trevershick</a></span>
      <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
-->
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>